#!/usr/bin/env bash

running() {
  nc -z localhost "$1"
}

start() {
  local accounts=(
    --account="0xabcd000000000000000000000000000000000000000000000000000000000000,100000000000000000000"
    --account="0xabcd000000000000000000000000000000000000000000000000000000000001,100000000000000000000"
    --account="0xabcd000000000000000000000000000000000000000000000000000000000002,100000000000000000000"
    --account="0xabcd000000000000000000000000000000000000000000000000000000000003,100000000000000000000"
    --account="0xabcd000000000000000000000000000000000000000000000000000000000004,100000000000000000000"
    --account="0xabcd000000000000000000000000000000000000000000000000000000000005,100000000000000000000"
    --account="0xabcd000000000000000000000000000000000000000000000000000000000006,100000000000000000000"
    --account="0xabcd000000000000000000000000000000000000000000000000000000000007,100000000000000000000"
    --account="0xabcd000000000000000000000000000000000000000000000000000000000008,100000000000000000000"
    --account="0xabcd000000000000000000000000000000000000000000000000000000000009,100000000000000000000"
  )

  # gasLimit is set to 8 mil
  npx ganache-cli --gasLimit 0x7A1200 --port "$1" "${accounts[@]}"
}

GANACHE_PORT=${GANACHE_PORT:-8545}

if running $GANACHE_PORT; then
  echo "Using existing chain on port 8545."
else
  echo "Starting our own ganache-cli instance."
  start $GANACHE_PORT
fi
